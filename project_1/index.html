<!DOCTYPE html>
<head>
    <title>Project 0</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            margin: 0 auto;
            max-width: 960px;
            padding: 20px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* from https://developer.mozilla.org/en-US/docs/Web/CSS/grid-template-columns */
            gap: 10px;
        }
        
        .gallery-item {
            text-align: center;
        }

        .gallery-item img {
            width: 100%;
            height: 300px; 
            object-fit: cover;
        }

        .gallery-item p {
            margin-top: 5px;
            font-size: 0.9em;
            color: #555;
        }

        h1, h2, h3 {
            color: #333;
        }

        ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        li {
            margin-bottom: 10px;
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #101256;
            color: white;
            transition: background-color 0.3s ease;
        }
        
        .button:hover {
            background-color: #63dac4;
        }
        
    </style>
</head>
<body>
    <a href="../index.html">
        <button class="button">home</button>
    </a>
    
    <h1>Project Overview</h1>
    <p>The goal of this project is to take digitized glass plate photographs from Sergei Prokudin-Gorskii and produce a full-color image. Prokudin-Gorskii captured scenes using three separate black-and-white exposures, each with a red, green, or blue filter. The Library of Congress purchased RGB glass plate negatives documenting the final years of the Russian Empire. The collection has recently been digitized and can be viewed online at the library of congress. My task is to align these negatives into a single color photograph.</p>

    <hr>

    <h2>Alignment Process</h2>

    <h3>1. Single Scale Image Process</h3>
    <p>The first step is to split the single input image into three equal parts representing the blue (B), green (G), and red (R) channels. After the red and green channels are aligned to the blue channel, they are stacked back together. The final output is an RGB image composed of the aligned red channel, the reference green channel, and the aligned blue channel. For small images, we use an exhaustive search between (-15, 16) for both x and y to find the best alignment. For larger tif images, we use the image pyramid approach.</p>
    
    <div class="gallery-grid">
        <div class="gallery-item">
            <img src="web/images/jpg_result/cathedral_ncc.jpg" alt="Cathedral">
            <p>Cathedral: Red:[12,3] Green:[5,2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/jpg_result/monastery_ncc.jpg" alt="Monastery">
            <p>Monastery: Red:[3,2] Green:[-3,2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/jpg_result/tobolsk_ncc.jpg" alt="Tobolsk">
            <p>Tobolsk: Red:[58,-4] Green:[25,4]</p>
        </div>
    </div>
    <h3>2. L2 and NCC Metric</h3>
    <p>The L2 norm, or Euclidean distance is calculated by taking the square root of the sum of the squared differences taken over the pixel values: sqrt(sum(sum((image1-image2).^2)). In my implementation, NCC performs better than L2. NCC is calculated through a dot product between two normalized image vectors: (image1./||image1|| and image2./||image2||). For each possible x and y shift within (-15, 16), it calculates the NCC between a shifted version of one image and a reference image. The shift that yields the highest NCC score is considered the best alignment.</p>
    
    <h3>3. Multi-Scale with Image Pyramid</h3>
    <p>To handle large and high-resolution tif images efficiently, I used a multi-scale image pyramid approach. I implemented a recursive function that:</p>
    <ul>
        <li>Downscales the input images by a factor of 0.5 until a predefined small size.</li>
        <li>Recursively calls itself on these smaller images to find a coarse alignment.</li>
        <li>Upscales the aligned, smaller image back to the original size.</li>
        <li>Refines the alignment on the full-resolution image using a smaller, final search window around the estimated position from the previous level.</li>
    </ul>
    <p>This coarse-to-fine approach significantly speeds up the process, making it feasible to align large .tif files, which would otherwise be computationally expensive and time consuming.</p>
    
    <h3>4. Cropping</h3>
    <p>A key refinement that helped me get more precise images is the use of aggressive cropping. Before any alignment, I crop 15% of each channel, leaving behind 85% of the original image. This is done to remove artifacts and lens distortions that are common on the edges of the original photographs. The alignment and final color image are then based on these cropped images.</p>

    <h3>5. Emir</h3>
    <p> I had trouble with Emir but then I was able to get a better alignment through changing the color order and aligning based on the green channel instead of the blue channel. </p>
    <div class="gallery-grid">
        <div class="gallery-item">
            <img src="web/images/jpg_result/old_emir.jpg" alt="emir">
            <p>Emir based on blue channel</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/jpg_result/new_emir.jpg" alt="emir">
            <p>Emir based on green channel</p>
        </div>
    </div>
    <hr>

    <h3> final results</h3>
    <p> I had trouble with Emir but then I was able to get a better alignment through changing the color order and aligning based on the green channel instead of the blue channel. </p>
    <div class="gallery-grid">
        <div class="gallery-item">
            <img src="web/images/final_results/cathedral+pyramid_cropped.png" alt="Cathedral">
            <p>Cathedral: Red:[12,3] Green:[5,2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/church+pyramid_cropped.png" alt="Church">
            <p>Church: Red:[58,-5] Green:[25,3]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/emir+pyramid_cropped.png" alt="Emir">
            <p>Emir: Red:[40,107] Blue:[23,50]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/harvesters+pyramid_cropped.png" alt="Harvesters">
            <p>Harvesters: Red:[124,13] Green:[60,16]</p>
        </div>
    </div>
    <hr>

    <h3>Final Results</h3>
    <p>Here are the final results</p>
    <div class="gallery-grid">
        <div class="gallery-item">
            <img src="web/images/final_results/cathedral+pyramid_cropped.png" alt="Cathedral">
            <p>Cathedral: Red:[12,3] Green:[5,2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/church+pyramid_cropped.png" alt="Church">
            <p>Church: Red:[58,-5] Green:[25,3]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/emir+pyramid_cropped.png" alt="Emir">
            <p>Emir: Red:[40,107] Blue:[23,50]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/harvesters+pyramid_cropped.png" alt="Harvesters">
            <p>Harvesters: Red:[124,13] Green:[60,16]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/icon+pyramid_cropped.png" alt="Icon">
            <p>Icon: Red:[88,23] Green:[41,17]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/italil+pyramid_cropped.png" alt="Italil">
            <p>Italil: Red:[77,35] Green:[38,21]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/lastochikino+pyramid_cropped.png" alt="Lastochikino">
            <p>Lastochikino: Red:[76,-9] Green:[-3,-2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/lugano+pyramid_cropped.png" alt="Lugano">
            <p>Lugano: Red:[22,-93] Green:[-30,-93]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/melons+pyramid_cropped.png" alt="Melons">
            <p>Melons: Red:[132,4] Green:[82,2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/monastery+pyramid_cropped.png" alt="Monastery">
            <p>Monastery: Red:[3,2] Green:[-3,2]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/self_portrait+pyramid_cropped.png" alt="Self Portrait">
            <p>Self Portrait: Red:[58,-4] Green:[25,4]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/siren+pyramid_cropped.png" alt="Siren">
            <p>Siren: Red:[96,-25] Green:[49,-7]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/three_generations+pyramid_cropped.png" alt="Three Generations">
            <p>Three Generations: Red:[112,10] Green:[53,13]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/final_results/tobolsk+pyramid_cropped.png" alt="Tobolsk">
            <p>Tobolsk: Red:[58,-4] Green:[25,4]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/more_images/cabins.jpg" alt="Tobolsk">
            <p>cabin: Red:[126,-4] Green:[59,4]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/more_images/monrepos_park.jpg" alt="Tobolsk">
            <p>monrepos park: Red:[2,165] Green:[3,44]</p>
        </div>
        <div class="gallery-item">
            <img src="web/images/more_images/route.jpg" alt="Tobolsk">
            <p>route: Red:[31,34] Green:[20,18]</p>
        </div>
    </div>
    <hr>

</body>
</html>